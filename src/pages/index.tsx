import Head from "next/head";
import { MusicList } from "types";
import getNewAlbums from "@/utils/getNewAlbums";
import Albums from "@/components/Albums";

type HomeProps = {
  newAlbums: { area: "EA" | "JP" | "KR" | "ZH"; albums: MusicList[] }[];
};

export default function Home({ newAlbums }: HomeProps) {
  return (
    <>
      <Head>
        <title>Taotify</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      {newAlbums.map((newAlbums, index) => (
        <Albums key={index} area={newAlbums.area} albums={newAlbums.albums} />
      ))}
    </>
  );
}

export /* istanbul ignore next */ async function getStaticProps() {
  const areas = ["EA", "JP", "KR", "ZH"];
  const newAlbums = await Promise.all(
    areas.map(async (area) => {
      const albums = await getNewAlbums(area, 7);
      return { area: area, albums: albums };
    })
  );

  return {
    props: { newAlbums },
    revalidate: 600,
  };
}
